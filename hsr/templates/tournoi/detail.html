{% extends 'base.html' %}
{% block title %}Tournois | {{block.super}}{% endblock %}

{% block content %}
<script language="JavaScript">
function getSelect(selectId,destId)
{
    var selectElmt = document.getElementById(selectId);
    document.getElementById(destId).value = document.getElementById(destId).value+selectElmt.options[selectElmt.selectedIndex].value+" ";
}
</script>
<a href="/tournoi/">Tournois</a>
<h3>Tournoi {{tournoi.name}}</h3>
<p><a href="/tournoi/arbre/{{tournoi.id}}">Arbre</a></p>
    {% if tournoi.termine %}<center>Ce tournoi est terminé</center><br />{% endif %}
    {% if tournoi.vainqueur %}<center><b>Le vainqueur est {{tournoi.vainqueur.profil_set.all.0.pseudo}}</b></center><br />{% endif %}
    <center>{% if inscrit %}<span style="color:green;">Vous êtes inscrit à ce tournoi{% if inscrop %} (<a href="/tournoi/desinscription/{{tournoi.id}}">Se désinscrire</a>){% endif %}</span>{% else %}{% if inscrop %}<a href="/tournoi/inscription/{{tournoi.id}}">S'inscrire au tournoi</a>{% endif %}{% endif %}</center>
    {% if membres %}
    <table class="forum_page">
    <tr>
    <th colspan="2">Staff du tournoi</th>
    <th colspan="2">Invités au tournoi</th>
    </tr>
    <tr>
    <td>Contacts : <select id="staff_contact" onchange="getSelect('staff_contact','staff')">
    <option value="">-----</option>
    {% for contact in contacts %}
    <option value="{{contact.contact.pseudo}}">{{contact.contact.pseudo}}</option>
    {% endfor %}
    </select>
    </td>
    <td>Membres : <select id="staff_membre" onchange="getSelect('staff_membre','staff')">
    <option value="">-----</option>
    {% for membre in membres %}
    <option value="{{membre.pseudo}}">{{membre.pseudo}}</option>
    {% endfor %}
    </select>
    </td>
    <td>Contacts : <select id="invit_contact" onchange="getSelect('invit_contact','invit')">
    <option value="">-----</option>
    {% for contact in contacts %}
    <option value="{{contact.contact.pseudo}}">{{contact.contact.pseudo}}</option>
    {% endfor %}
    </select>
    </td>
    <td>Membres : <select id="invit_membre" onchange="getSelect('invit_membre','invit')">
    <option value="">-----</option>
    {% for membre in membres %}
    <option value="{{membre.pseudo}}">{{membre.pseudo}}</option>
    {% endfor %}
    </select>
    </td>
    </tr>
    <tr>
    <td colspan="2"><form action="/tournoi/detail/{{tournoi.id}}" method="POST">{% csrf_token %}<input type="hidden" name="action" value="staff" /><textarea cols="45%" rows="3" name="staff" id="staff">{% for staff in staffs %}{{staff.admin.username}} {% endfor %}</textarea><br /><input type="submit" value="Editer le staff" /></form></td>
    <td colspan="2"><form action="/tournoi/detail/{{tournoi.id}}" method="POST">{% csrf_token %}<input type="hidden" name="action" value="invite" /><textarea cols="45%" rows="3" name="invit" id="invit">{% for invite in invites %}{{invite.invite.username}} {% endfor %}</textarea><br /><input type="submit" value="Editer les invitations" /></form></td>
    </tr>
    </table>
    {% endif %}
<table class="forum_page">
<tbody>
    {% if tournoi.prive %}
    <tr style="background-color: rgba(230,184,138,0.15);">            
    <th colspan="2" style="color:red;">Ce tournoi est privé</th>
    </tr>
    {% endif %}
    <tr style="background-color: rgba(230,184,138,0.1);">
    <td><img src="{{tournoi.admin.profil_set.all.0.avatar}}" /></td>
    <td>{{tournoi.admin.profil_set.all.0.pseudo}}</td>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.15);">            
    <td>{{tournoi.date|date:"d-m-Y"}}</td>
    <td>{{tournoi.heure|date:"H:i"}}</td>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.1);">
    <th colspan="2">Description</th>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.15);">            
    <td colspan="2">{{tournoi.descr}}</td>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.1);">
    <th colspan="2">Règles</th>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.15);">            
    <td colspan="2">{{tournoi.regles}}</td>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.1);">
    <th>Participants</th>
    <td>{{tournoi.inscrit}} / {{tournoi.max_participants}}</td>
    </tr>
    <tr style="background-color: rgba(230,184,138,0.15);">            
    <th>Formats</th>
    <td>
    {% if tournoi.poules %}Poules : {{tournoi.get_poules_display}}<br />{% endif %}
    {% if tournoi.loser_bracket %} Loser bracket : {{tournoi.get_loser_bracket_display}}<br />{% endif %}
    Matchs : {{tournoi.get_match_display}}<br />
    Finale : {{tournoi.get_finale_display}}<br />
    </td>
    </tr>
</tbody>
</table>
<h3>Staff</h3>
<ul>
<li><a href="/profil/detail/{{tournoi.admin.profil_set.all.0.id}}/">{{tournoi.admin.profil_set.all.0.pseudo}}</a> (<a href="/notification/new_message/?dest={{tournoi.admin.profil_set.all.0.pseudo}}">message</a>)</li>
{% for s in staffs %}
<li><a href="/profil/detail/{{s.admin.profil_set.all.0.id}}/">{{s.admin.profil_set.all.0.pseudo}}</a> (<a href="/notification/new_message/?dest={{s.admin.profil_set.all.0.pseudo}}">message</a>)</li>
{% endfor%}
</ul>
<h3>Inscrits</h3>
<ul>
{% for i in inscrits %}
<li><a href="/profil/detail/{{i.user.profil_set.all.0.id}}/">{{i.user.profil_set.all.0.pseudo}}</a></li>
{% endfor %}
</ul>
{% if attente %}
<h3>En attente</h3>
<ul>
{% for i in attente %}
<li><a href="/profil/detail/{{i.user.profil_set.all.0.id}}/">{{i.user.profil_set.all.0.pseudo}}</a></li>
{% endfor %}
</ul>
{% endif %}
{% endblock %}
